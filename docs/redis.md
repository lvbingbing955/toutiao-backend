# 1 应用场景

* 验证码
* 阅读历史 （无有效期）
* 缓存

# 2 考虑的问题

* 单机 or 分布式集群
* 历史记录 持久化
* 缓存 设置过期
* watch什么时候使用
* redis 锁

 # 3 方案

1. 采用两个缓存
   * 读缓存 -> 用作cache
   * 写缓存 -> 用作storage 

2. 读缓存使用 Redis Cluster -> 容量大

   * 不做持久化 ——————
   * 设置TTL （有效期指定范围随机，防止缓存雪崩）
   * 设置volitle LRU

3. 写缓存应该使用集群，但为了教学，使用单机

   * 用于存储浏览历史记录（每人100）+ 统计数据

   * Sentinel +主从双机
   * AOF持久化
   * 不设置TTL
   * 设置noeviction

4. 缓存更新

   * 读缓存 cache aside 先写数据库 再删缓存
   * 写缓存 write behind 定时更新数据库持久化



